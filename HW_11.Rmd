---
title: "HW_11"
author: "Sam Tybout and Hartford Johnson"
date: "11/18/2019"
output: html_document
---

**1) Using the R data Titanic, use apply to answer the following:**  

Were rates of survival higher among children or adults?  

```{r}
apply(Titanic, c(3,4), sum)
```
Rates of survival were higher among children than adults, although the rates for 3rd class children were
comparable to most adult men.

Were rates of survival higher among men or women?  

```{r}
apply(Titanic, c(2,4), sum)
```
Rates of survival were higher among women than men.


**2) Some insect species can only survive if daily temperatures stay above some temperature.  Write a function that takes two arguments, a data frame and a temperature that returns a TRUE when the tmin > X and a FALSE when tmin is < X, where X is the threshold temperature.  Have the function then add a logical vector to each daily climate data frame reporting whether that threshold was exceeded (TRUE) or not (FALSE). Apply this function across all three of the daily data frames provided in /data. For each data frame, your results might look like:**

```{r, include=FALSE}
load_data = function(path = 'data'){
  setwd(".")
  filenames = list.files(path = path)
  dataFiles = lapply(paste0(path, '/', filenames), read.csv, skip = 10, col.names = c('Date', 'ppt', 'tmin', 'tmean', 'tmax'))
  names(dataFiles) = sub('.csv','',filenames)
  return(dataFiles)
}

tcheck = function(data, threshold){
  data$thresh = data$tmin > threshold
  return(data)
}

tcheck_all = function(data_list, threshold){
  return(lapply(data_list, tcheck, threshold = threshold))
}
```

**3) Write a loop to extract Cape Grim monthly temperature data (GHCN) for 1985-2019 using rnoaa.**
  
```{r}
data = data.frame()
for(year in 1985:2019){
  start = paste0(as.character(year), '-01-01')
  end = paste0(as.character(year), '-12-31')
  data = rbind(data, ncdc(datasetid = 'GSOM', stationid = 'GHCND:ASN00091245', datatypeid = "TAVG", startdate = start, enddate = end)[["data"]])
  Sys.sleep(0.2)
}
data
```

**4) Calculate the average annual temperature and the number of months used to generate the mean from #3 above (years without data can be excluded).  Report in a table.**

```
install.packages("kableExtra")
```
```
library(knitr)
library(kableExtra)
```
```
{r, echo = FALSE}
yearmean = function(yeardata){
  return(data.frame(T_average = mean(yeardata$value), n_months = nrow(yeardata)))
}
```
```{r}
data$year = as.integer(substr(data$date, 1, 4))
yearlist = split(data, data$year)
means = lapply(yearlist, yearmean)
means = do.call(rbind, means)
means %>%
  kable(digits=3) %>%
  kable_styling()
```